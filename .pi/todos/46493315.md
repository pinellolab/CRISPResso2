{
  "id": "46493315",
  "title": "Add triage workflow to review extension with finding IDs and todo integration",
  "tags": [
    "review",
    "triage",
    "extension"
  ],
  "status": "closed",
  "created_at": "2026-02-10T19:37:37.526Z"
}

## Goal

Add a triage workflow to the review extension so findings get human-readable IDs (`C1`, `C2`, `D1`, `D2`, etc.) and can be approved (creating todos) or rejected.

## Scope

- Add `/triage`, `/approve`, `/reject` commands to `~/.pi/agent/extensions/review.ts`
- Add `review-findings` session entry type for persistent state via `pi.appendEntry()`
- Integrate with existing `todo` tool for quick-create
- Integrate with existing `/plan` prompt pattern for refine path
- Do NOT modify `todos.ts`

## Commands

### `/triage`
- First invocation: parse findings from assistant messages (reuse existing `parseReviewFindings` + `getAssistantMessages`), assign IDs (`C1`, `C2` for correctness, `D1`, `D2` for design), store via `appendEntry("review-findings", ...)`, show interactive list
- Subsequent invocations: read latest `review-findings` entry, show interactive list with status
- Interactive list shows each finding with status (pending/approved/rejected) and allows approve/reject from there

### `/approve C1 C3`
- Approve findings by ID (supports multiple IDs in one command)
- For each finding, prompt: "Quick create todo" or "Refine in plan mode"
- Quick create: use `todo` tool â€” title = `[C1] {issue}`, body = file + details + suggestion, tags = `["review", type]`
- Refine: pre-fill editor with plan mode prompt containing finding context (no automatic todo linking)
- Store created todo ID back on finding in `todoId` field (quick-create only)
- Append updated state

### `/reject D1 C2`
- Mark findings as rejected (no prompt, just update status)
- Append updated state

## State

```typescript
type StoredFinding = {
  id: string;              // "C1", "D2", etc.
  status: "pending" | "approved" | "rejected";
  todoId?: string;         // linked TODO-<hex> if quick-created
  finding: ReviewFinding;  // existing parsed finding type
};

type StoredFindings = {
  findings: StoredFinding[];
};
```

Stored via `pi.appendEntry("review-findings", data)`. Latest entry wins. Read by scanning session entries for last `review-findings` entry (same pattern as existing `REVIEW_STATE_TYPE`).

## ID Assignment

- Correctness findings: `C1`, `C2`, `C3`, ... in order of appearance
- Design findings: `D1`, `D2`, `D3`, ... in order of appearance
- IDs are stable once stored (re-running `/triage` uses stored IDs, doesn't re-parse)

## Done when

- `/triage` parses findings from review output, assigns IDs, persists via appendEntry
- `/triage` on re-invocation shows stored state with pending/approved/rejected status
- `/approve` with quick-create creates a todo and links it back
- `/approve` with refine pre-fills editor with plan prompt containing finding context
- `/reject` marks findings as rejected
- State survives branch navigation (via appendEntry)
- Existing review commands (`/review`, `/end-review`, `/post-review`) continue to work
