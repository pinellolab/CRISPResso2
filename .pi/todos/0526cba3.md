{
  "id": "0526cba3",
  "title": "Fix VCF POS off-by-one for start-of-amplicon deletions when pos > 1",
  "tags": [
    "bug",
    "vcf",
    "tdd"
  ],
  "status": "closed",
  "created_at": "2026-02-10T18:11:51.845Z"
}

## Goal

Fix the off-by-one bug in `_edits_from_deletions` (`writers/vcf.py`) where deletions starting at position 0 of the amplicon produce a wrong VCF POS when `amplicon_coordinates` has `pos > 1`.

**Current behavior:** `left_index = max(1, pos + start - 1)` → for `start=0, pos=100` gives 99 (one base before the amplicon).
**Expected behavior:** `left_index = pos` when `start == 0` → gives 100.

## Scope

- Fix `left_index` calculation in `_edits_from_deletions` for the `start == 0` case
- Add new tests only; don't modify existing tests

## Approach (TDD)

### Step 1: Write failing tests

**`test_build_alt_map.py`** — two new tests via `build_edit_counts`:
- Single-base deletion at `start=0` with `pos=100`, assert VCF POS=100
- Multi-base deletion at `start=0` with `pos=100`, assert VCF POS=100

**`test_write_vcf.py`** — one new test via `_edits_from_deletions` directly:
- Deletion at start with `pos=100`, assert POS=100

### Step 2: Verify tests fail (expect POS=100, get 99)

### Step 3: Fix

In `_edits_from_deletions`, change `left_index` calculation so that when `start == 0`, `left_index = pos`.

### Step 4: Verify all tests pass (new + existing)

## Done when

- New tests pass with `pos > 1` and `start == 0` deletions
- Existing deletion tests still pass
- Full `test_writers/` suite green
